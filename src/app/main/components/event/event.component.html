<div class="container">
    <div class="flex">
        <div class="data">
            <div class="data__flex_id">
                <div class="data__box_id">
                    <p class="data__id">№ {{event?.id}}</p>
                </div>
            </div>
            <div class="data__content">
                <div class="data__flex">
                    <div>
                        <p class="data__title" style="color: #2196F3;">{{event?.sport.name}}</p>
                        <p class="data__subtitle_map" (click)="openDialog()">{{event?.location.name_address_short}}</p>
                    </div>
                    <div>
                        <p class="data__title" style="color: #2196F3;">{{event?.status.name}}</p>
                        <p class="data__subtitle" style="text-align: end;" *ngIf="event?.show_timer">до старта {{result | date: 'ddд. HHч. mmм. ssс.'}}</p>
                    </div>
                </div>
                <div class="data__flex">
                    <div>
                        <p class="data__title" style="font-size: 64px; font-weight: bold;">{{event?.short_time}}</p>
                        <p class="data__subtitle">{{event?.full_date}}</p>
                    </div>
                    <div>
                        <p class="data__title">{{event?.type.name}}</p>
                        <p class="data__subtitle" style="text-align: end;">создатель события <span style="color: #2196F3; cursor: pointer;" (click)="getCreate(event?.created_by)">{{event?.created_by?.full_name}}</span></p>
                    </div>
                </div>
                <div class="data__flex">
                    <div *ngIf="event?.price != 0 && event?.price != null">
                        <p class="data__title">{{event?.price}}/<span>{{statistics?.event_stats.price_per_player}}&#8381;</span></p>
                        <p class="data__subtitle">[общая/<span>с человека</span>]</p>
                    </div>
                    <div *ngIf="event?.price == 0 || event?.price == null">
                        <p class="data__title">Бесплатно</p>
                        <p class="data__subtitle">[сборы не взимаются]</p>
                    </div>
                    <p class="data__description">{{event?.comment}}</p>
                </div>
            </div>
        </div>
        
        <div class="vote">
            
            <div class="vote__box" *ngIf="application?.application != null && application?.application.status.id == '1'">
                <div style="background-color: #2196F3;">
                    <p class="vote__head_title">ЗАЯВКА ПОДАНА!</p>
                </div>
                <div class="vote__box_text">
                    <p class="vote__title">Вы уже оставили заявку на событие.</p>
                    <span class="vote__subtitle">{{application?.application.status.description}}</span>

                    <p class="vote__title" *ngIf="event?.status.id == 1">Заявка на участие в открытом событии.</p>
                    <p class="vote__title" *ngIf="event?.status.id == 5">Заявка на участие в закрытом событии.</p>
                    <span class="vote__subtitle">{{event?.type.description}}</span>
                </div>
            </div>

            <div class="vote__box" *ngIf="application?.application != null && application?.application.status.id == '5'">
                <div style="background-color: #2196F3;">
                    <p class="vote__head_title">ОТКАЗ ОТ УЧАСТИЯ!</p>
                </div>
                <div class="vote__box_text">
                    <p class="vote__title">Вы отказались участвовать в событии.</p>
                    <span class="vote__subtitle">{{application?.application.status.description}}</span>

                    <p class="vote__title" *ngIf="event?.status.id == 1">Заявка на участие в открытом событии.</p>
                    <p class="vote__title" *ngIf="event?.status.id == 5">Заявка на участие в закрытом событии.</p>
                    <span class="vote__subtitle">{{event?.type.description}}</span>
                </div>
            </div>

            <div class="vote__box" *ngIf="application?.application != null && application?.application.status.id == '2'">
                <div style="background-color: #2196F3;">
                    <p class="vote__head_title">ЗАЯВКА ПРИНЯТА!</p>
                </div>
                <div class="vote__box_text">
                    <p class="vote__title">Ваша заявка была подтверждена.</p>
                    <span class="vote__subtitle">{{application?.application.status.description}}</span>

                    <p class="vote__title" *ngIf="event?.status.id == 1">Заявка на участие в открытом событии.</p>
                    <p class="vote__title" *ngIf="event?.status.id == 5">Заявка на участие в закрытом событии.</p>
                    <span class="vote__subtitle">{{event?.type.description}}</span>
                </div>
            </div>

            <div class="vote__box" *ngIf="application?.application !=null && application?.application.status.id == '4'">
                <div style="background-color: #2196F3;">
                    <p class="vote__head_title">ВЫ ПРИГЛАШЕНЫ!</p>
                </div>
                <div class="vote__box_text">
                    <p class="vote__title">Вас пригласил <span style="color: #00FFFF;">{{event?.created_by.full_name}}</span>.</p>
                    <span class="vote__subtitle" *ngIf="application?.application.comment_moderator">{{application?.application.comment_moderator}}</span>
                    <span class="vote__subtitle" *ngIf="!application?.application.comment_moderator">{{application?.status?.description}}</span>

                    <p class="vote__title" *ngIf="event?.status.id == 1">Заявка на участие в открытом событии.</p>
                    <p class="vote__title" *ngIf="event?.status.id == 5">Заявка на участие в закрытом событии.</p>
                    <span class="vote__subtitle">{{event?.type.description}}</span>
                </div>
            </div>

            <div class="vote__box" *ngIf="application?.application == null">
                <div style="background-color: #2196F3;">
                    <p class="vote__head_title">ОТКРЫТОЕ СОБЫТИЕ!</p>
                </div>
                <div class="vote__box_text">
                    <p class="vote__title">Вы можете принять участие в событии.</p>
                    <span class="vote__subtitle">{{application?.application.status.description}}</span>

                    <p class="vote__title" *ngIf="event?.status.id == 1">Заявка на участие в открытом событии.</p>
                    <p class="vote__title" *ngIf="event?.status.id == 5">Заявка на участие в закрытом событии.</p>
                    <span class="vote__subtitle">{{event?.type.description}}</span>
                </div>
            </div>

            <div class="vote__box" *ngIf="application?.application != null && application?.application.status.id == '3'">
                <div style="background-color: #2196F3;">
                    <p class="vote__head_title">ЗАЯВКА ОТКЛОНЕНА!</p>
                </div>
                <div class="vote__box_text">
                    <p class="vote__title">Вам запрещено участвовать в событии.</p>
                    <span class="vote__subtitle" *ngIf="application?.application.comment_moderator">{{application?.application.comment_moderator}}</span>
                    <span class="vote__subtitle" *ngIf="!application?.application.comment_moderator">{{application?.status.description}}</span>

                    <p class="vote__title" *ngIf="event?.status.id == 1">Заявка на участие в открытом событии.</p>
                    <p class="vote__title" *ngIf="event?.status.id == 5">Заявка на участие в закрытом событии.</p>
                    <span class="vote__subtitle">{{event?.type.description}}</span>
                </div>
            </div>

            <div class="vote__box_btns" *ngIf="application?.can_edit">
                <button class="vote__btn_accept" (click)="sendAccept()" [ngClass]="{vote__btn_mute: !application?.accept_button}">принять</button>
                <button class="vote__btn_refuse" (click)="sendReject()" [ngClass]="{vote__btn_mute: !application?.refuse_button}">отказать</button>
            </div>
        </div>
    </div>
    <div class="participants__box_btns">
        <button class="participants__btn" (click)="viewPlayers()" [ngClass]="{participants__btn_active: nav.players}">ИГРОКИ</button>
        <button class="participants__btn" (click)="viewChat()" [ngClass]="{participants__btn_active: nav.chat}">ЧАТ</button>
        <button class="participants__btn" (click)="viewControl()" [ngClass]="{participants__btn_active: nav.control}">УПРАВЛЕНИЕ</button>
    </div>
    <div class="flex">
        <div *ngIf="nav.players">
            <div class="participants__data">
                <div class="participants__filters">
                    <button [ngClass]="{active_filter: view.accepted}" class="participants__btn_filter" (click)="viewAccepted()">
                        <mat-icon style="color: #FFFFFF; font-size: 36px; margin: 0 20px 15px 0;" aria-hidden="false" aria-label="Example logout icon">done</mat-icon>
                        УЧАСТНИКИ <span>({{statistics?.applications.accepted}})</span>
                    </button>
                    <button [ngClass]="{active_filter: view.guests}" class="participants__btn_filter" (click)="viewGuests()">
                        <mat-icon style="color: #FFFFFF; font-size: 36px; margin: 0 20px 15px 0;" aria-hidden="false" aria-label="Example logout icon">groups</mat-icon>
                        ГОСТИ <span>({{statistics?.guests_stats.all}})</span>
                    </button>
                    <button [ngClass]="{active_filter: view.refused}" class="participants__btn_filter" (click)="viewRefused()">
                        <mat-icon style="color: #FFFFFF; font-size: 36px; margin: 0 20px 15px 0;" aria-hidden="false" aria-label="Example logout icon">close</mat-icon>
                        НЕ ПРИДУТ <span>({{statistics?.applications.refused}})</span>
                    </button>
                    <button [ngClass]="{active_filter: view.invited}" class="participants__btn_filter" (click)="viewInvited()">
                        <mat-icon style="color: #FFFFFF; font-size: 32px; margin: 0 20px 10px 0;" aria-hidden="false" aria-label="Example logout icon">mark_email_unread</mat-icon>
                        ПРИГЛАШЕНЫ <span>({{statistics?.applications.invited}})</span>
                    </button>
                    <button [ngClass]="{active_filter: view.rejected}" class="participants__btn_filter" (click)="viewRejected()">
                        <mat-icon style="color: #FFFFFF; font-size: 28px; margin: 0 20px 10px 0;" aria-hidden="false" aria-label="Example logout icon">pan_tool</mat-icon>
                        ОТКЛОНЕНЫ <span>({{statistics?.applications.rejected}})</span>
                    </button>
                </div>

                <div style="width: 444px;">
                    <div *ngIf="view.accepted" class="participants__list">
                        <div class="participants__cell" *ngFor="let application of applications" (click)="getUser(application)">
                            <img *ngIf="application.user.profile.photo_small" src="{{application.user.profile.photo_small}}" alt="avatar" class="participants__avatar">
                            <div *ngIf="!application.user.profile.photo_small" class="participants__avatar"></div>
                            <div>
                                <p class="participants__status">[{{application.user_status.status}}]</p>
                                <p class="participants__name">{{application.user.full_name}}</p>
                            </div>
                        </div>
                    </div>
        
                    <div class="participants__list" *ngIf="view.guests">
                        <div class="participants__cell" *ngFor="let guest of event.guests">
                            <img *ngIf="application.user.profile.photo_small" src="{{application.user.profile.photo_small}}" alt="avatar" class="participants__avatar">
                            <div *ngIf="!application.user.profile.photo_small" class="participants__avatar"></div>
                            <div>
                                <p class="participants__status">[игрок]</p>
                                <p class="participants__name">{{guest.name}}</p>
                            </div>
                        </div>
                    </div>

                    <div class="participants__list" *ngIf="view.refused">
                        <div class="participants__cell" *ngFor="let application of applications" (click)="getUser(application.user.id)">
                            <img *ngIf="application.user.profile.photo_small" src="{{application.user.profile.photo_small}}" alt="avatar" class="participants__avatar">
                            <div *ngIf="!application.user.profile.photo_small" class="participants__avatar"></div>
                            <div>
                                <p class="participants__status">[игрок]</p>
                                <p class="participants__name">{{application.user.full_name}}</p>
                            </div>
                        </div>
                    </div>

                    <div class="participants__list" *ngIf="view.invited">
                        <div class="participants__cell" *ngFor="let application of applications" (click)="getUser(application.user.id)">
                            <img *ngIf="application.user.profile.photo_small" src="{{application.user.profile.photo_small}}" alt="avatar" class="participants__avatar">
                            <div *ngIf="!application.user.profile.photo_small" class="participants__avatar"></div>
                            <div>
                                <p class="participants__status">[игрок]</p>
                                <p class="participants__name">{{application.user.full_name}}</p>
                            </div>
                        </div>
                    </div>

                    <div class="participants__list" *ngIf="view.rejected">
                        <div class="participants__cell" *ngFor="let application of applications" (click)="getUser(application.user.id)">
                            <img *ngIf="application.user.profile.photo_small" src="{{application.user.profile.photo_small}}" alt="avatar" class="participants__avatar">
                            <div *ngIf="!application.user.profile.photo_small" class="participants__avatar"></div>
                            <div>
                                <p class="participants__status">[игрок]</p>
                                <p class="participants__name">{{application.user.full_name}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="chat" *ngIf="nav.chat">
            <event-chat-service-page></event-chat-service-page>
        </div>
        <div class="control" *ngIf="nav.control">
            <h1 style="color: #FFFFFF;">control</h1>
        </div>
        <div class="user" *ngIf="status">
            <img *ngIf="user.profile.photo_medium" src="{{user?.profile.photo_medium}}" alt="avatar" class="user__avatar">
            <div *ngIf="!user.profile.photo_medium" class="user__avatar"></div>
            <div>
                <p class="user__status">[{{status}}]</p>
                <p class="user__name">{{user?.full_name}}</p>
            </div>
            <p class="user__title">{{user?.first_name}} <br> {{user?.last_name}}</p>
        </div>
    </div>
</div>

<div class="spinner" *ngIf="spinner">
    <mat-spinner></mat-spinner>
</div>